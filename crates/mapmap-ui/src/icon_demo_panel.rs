//! Icon Demo Panel
//!
//! Shows all available Ultimate Colors icons for preview.

use crate::i18n::LocaleManager;
use crate::icons::{AppIcon, IconManager};
use egui::Ui;

/// Panel to display all available icons
pub struct IconDemoPanel {
    /// Whether the panel is visible
    pub visible: bool,
    /// Icon display size
    pub icon_size: f32,
}

impl Default for IconDemoPanel {
    fn default() -> Self {
        Self {
            visible: false,
            icon_size: 48.0,
        }
    }
}

impl IconDemoPanel {
    /// Create a new icon demo panel
    pub fn new() -> Self {
        Self::default()
    }

    /// Render the icon demo panel
    pub fn ui(&mut self, ui: &mut Ui, icons: Option<&IconManager>, _locale: &LocaleManager) {
        if !self.visible {
            return;
        }

        egui::Window::new("üé® Icon Gallery - Ultimate Colors")
            .default_size([500.0, 400.0])
            .resizable(true)
            .open(&mut self.visible)
            .show(ui.ctx(), |ui| {
                ui.heading("Ultimate Colors - Free Icons");
                ui.separator();

                // Icon size slider
                ui.horizontal(|ui| {
                    ui.label("Icon Size:");
                    ui.add(egui::Slider::new(&mut self.icon_size, 24.0..=128.0).suffix("px"));
                });

                ui.separator();

                if let Some(icon_manager) = icons {
                    // Display icons in a grid
                    egui::ScrollArea::vertical().show(ui, |ui| {
                        let available_width = ui.available_width();
                        let cols = ((available_width - 20.0) / (self.icon_size + 80.0))
                            .floor()
                            .max(1.0) as usize;

                        egui::Grid::new("icon_grid")
                            .spacing([16.0, 16.0])
                            .show(ui, |ui| {
                                for (i, icon) in AppIcon::all().iter().enumerate() {
                                    ui.vertical(|ui| {
                                        ui.set_width(self.icon_size + 60.0);

                                        // Icon background
                                        egui::Frame::none()
                                            .fill(egui::Color32::from_rgb(30, 35, 45))
                                            .rounding(8.0)
                                            .inner_margin(12.0)
                                            .show(ui, |ui| {
                                                ui.centered_and_justified(|ui| {
                                                    if let Some(img) =
                                                        icon_manager.image(*icon, self.icon_size)
                                                    {
                                                        ui.add(img);
                                                    } else {
                                                        ui.label("‚ùå");
                                                    }
                                                });
                                            });

                                        // Icon name
                                        ui.label(
                                            egui::RichText::new(format!("{:?}", icon))
                                                .size(10.0)
                                                .color(egui::Color32::GRAY),
                                        );
                                    });

                                    if (i + 1) % cols == 0 {
                                        ui.end_row();
                                    }
                                }
                            });
                    });
                } else {
                    ui.colored_label(
                        egui::Color32::YELLOW,
                        "‚ö† Icons not loaded. Make sure assets/icons folder exists.",
                    );

                    ui.separator();
                    ui.label("Expected icon files:");
                    for icon in AppIcon::all() {
                        ui.label(format!("  ‚Ä¢ {}", icon.file_name()));
                    }
                }
            });
    }
}
